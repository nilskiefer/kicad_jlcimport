name: Visual Comparison

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  pages: write
  id-token: write

jobs:
  compare:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deploy.outputs.page_url }}

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install KiCad
        run: |
          sudo add-apt-repository --yes ppa:kicad/kicad-9.0-releases
          sudo apt-get update
          sudo apt-get install -y kicad

      - name: Install project
        run: pip install -e .

      - name: Run visual comparison
        run: |
          python tools/compare_part.py \
            C1002 C1027 C1034 C1035 C2040 C2078 C2079 C2102 C2135 C2173 \
            C2202 C2203 C2213 C2286 C2288 C2290 C2295 C2297 C2316 C2318 \
            C2319 C2320 C2321 C2322 C2474 C2476 C2478 C2479 C2560 C2561 \
            C2562 C2564 C2566 C2765186 C2914 C2957 C2960 C3099 C3105 C3116 C3117 \
            C3794 C3795 C3797 C5177 C5206 C5213 C5419 C5423 C5586 C5602 \
            C5612 C5613 C6179 C6186 C6187 C6188 C6203 C6205 C6855 C6912 \
            C6970 C7063 C7519 C7593 C7950 C8760 C8852 C9418 C10081 C12087 \
            C12889 C13885 C14529 C15134 C15157 C15331 C15999 C18901 C20953 C21235 \
            C23892 C24112 C33696 C67528 C71101 C82899 C85181 C94598 C94599 C138392 \
            C173573 C173580 C173602 C347218 C347219 C385834 C386756 C386757 C386758 C393939 C395958 \
            C34376141 C52016391 C160404 \
            --output-dir ./pages --no-open

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./pages

      - name: Deploy to GitHub Pages
        id: deploy
        uses: actions/deploy-pages@v4
